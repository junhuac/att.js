(function(){function n(){this.callbacks={}}function t(t){var o=this,e=t||{},i=this.config={apiKey:"",user:l.uuid(),jid:"",log:!0,ringTone:"",ringbackTone:"",dependencyBaseUrl:"//js.att.io"},r={onReady:"ready",onUser:"user",onUnReady:"unready",onError:"error",onCallBegin:"callBegin",onCallEnd:"callEnd",onOutgoingCall:"outgoingCall",onCalling:"calling"},s={onError:"error",onCallBegin:"callBegin",onCallEnd:"callEnd"},a=function(){return l.isFunc(t.onIncomingCall)?t.onIncomingCall:t.phone&&l.isFunc(t.phone.onIncomingCall)?t.phone.onIncomingCall:function(){}}();return n.call(this),l.extend(this.config,e),this.config.incomingCallHandler=a,delete this.config.onIncomingCall,this.config.phone&&delete this.config.phone.onIncomingCall,this.phone=this,this.on("incomingCall",a),l.each(r,function(n,t){l.isFunc(o.config[n])&&(o.on(t,o.config[n]),o.config[n]=function(n){o.emit(t,n)})}),e.phone&&l.each(s,function(n,t){l.isFunc(o.config.phone[n])&&(o.on(t,o.config.phone[n]),o.config.phone[n]=function(n){o.emit(t,n)})}),this.config.log&&this.on("*",function(n,t){console.log("att.js event:",n,t)}),l.getMe(this.config.apiKey,function(n){n.version=i.version||l.getQueryParam("version")||n.version,i.version=n.version,i.myNumber=n.number,console.log("using API version:",i.version),o.emit("user",n),"a1"===i.version||"a2"===i.version?c.getScript(i.dependencyBaseUrl+"/js/att."+i.version+".js",function(){o.fetchDependencies(i.version)}):c.getScript(i.dependencyBaseUrl+"/js/phono.06.js",function(){i.token=i.apiKey,i.apiKey="7826110523f1241fcfd001859a67128d",i.connectionUrl="http://gw.att.io:8080/http-bind",o.fetchDependencies()})}),o}function o(t,o){var e=this;return this._att=t,this._call=o,this.id=o.id,n.call(this),this.on("*",function(n){e._att.emit(n,e)}),this._call.bind({onRing:function(){e.emit("ring")},onAnswer:function(){e.emit("callBegin")},onHangup:function(){e.emit("callEnd")},onHold:function(){e.emit("hold")},onRetrieve:function(){e.emit("retrieve")},onWaiting:function(){e.emit("waiting")},onError:function(){e.emit("error")}}),this}function e(n,t){this.token=n,this.baseUrl=t}function i(n){this.api=new e(n,"https://api.foundry.att.com/a4/addressbook")}var r=this,s={},a={},c=r.jQuery,l=s.util={_uuidCounter:0,uuid:function(){return Math.random().toString(16).substring(2)+(l._uuidCounter++).toString(16)},slice:Array.prototype.slice,isFunc:function(n){return"[object Function]"==Object.prototype.toString.call(n)},extend:function(n){return this.slice.call(arguments,1).forEach(function(t){if(t)for(var o in t)n[o]=t[o]}),n},each:function(n,t){if(n)if(n instanceof Array)n.forEach(t);else for(var o in n)t(o,n[o])},getQueryParam:function(n){var t=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),o="[\\?&]"+t+"=([^&#]*)",e=RegExp(o),i=e.exec(window.location.search);return i?decodeURIComponent(i[1].replace(/\+/g," ")):void 0},h2sSupport:function(){return"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/536.4 (KHTML, like Gecko) Chrome/19.0.1077.0 Safari/536.4"==window.navigator.userAgent||"Mozilla/5.0 (iPhone; CPU iPhone OS 6_0_1 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Mobile/10A523"==window.navigator.userAgent||window.webkitPeerConnection00&&-1!==window.navigator.userAgent.indexOf("Chrome/24")},getMe:function(n,t){var o="https://auth.tfoundry.com",e={access_token:n};return a.me?t(a.me):(console.log(e),c.ajax({data:e,dataType:"json",url:o+"/me.json",success:function(n){a.me=n,c.ajax({data:e,dataType:"json",url:o+"/users/"+n.uid+"/api_services/webrtc.json",success:function(o){var e=o&&o.version,i=o&&o.options&&o.options.phone_number;n.version=e?"a"+e:"a1",n.number=i||n.phone_number,t(n)}})}}),void 0)}},u={};u.stringify=function(n){var t,o=u.parse(n),e=o.length,i="1"===o.charAt(0),r=o.split("");return e>(i?11:10)?o:!i&&4>e?o:(i&&r.splice(0,1),i?e>1&&(t=4-e,t=t>0?t:0,r.splice(0,0," ("),r.splice(4,0,Array(t+1).join(" ")+") "),e>7&&r.splice(8,0,"-")):e>7?(r.splice(0,0,"("),r.splice(4,0,") "),r.splice(8,0,"-")):e>3&&r.splice(3,0,"-"),(i?"1":"")+r.join(""))},u.parse=function(n){return(n+"").toUpperCase().replace(/[A-Z]/g,function(n){return 0|(n.charCodeAt(0)-65)/3+2-("SVYZ".indexOf(n)>-1)}).replace(/\D/g,"")},u.getCallable=function(n,t){var o=t||"us",e=u.parse(n);return 10!==e.length?"us"==o&&11===e.length&&"1"===e.charAt(0)?e:!1:"us"==o?"1"+e:void 0},s.phoneNumber=u,c&&(c.phoneNumber=u),n.prototype.on=function(n){var t=3===arguments.length,o=t?arguments[1]:void 0,e=t?arguments[2]:arguments[1];return e._groupName=o,(this.callbacks[n]=this.callbacks[n]||[]).push(e),this},n.prototype.once=function(n,t){function o(){e.off(n,o),t.apply(this,arguments)}var e=this;return this.on(n,o),this},n.prototype.releaseGroup=function(n){var t,o,e,i;for(t in this.callbacks)for(i=this.callbacks[t],o=0,e=i.length;e>o;o++)i[o]._groupName===n&&(i.splice(o,1),o--,e--);return this},n.prototype.off=function(n,t){var o,e=this.callbacks[n];return e?1===arguments.length?(delete this.callbacks[n],this):(o=e.indexOf(t),e.splice(o,1),this):this},n.prototype.emit=function(n){var t,o,e=[].slice.call(arguments,1),i=this.callbacks[n],r=this.getWildcardCallbacks(n);if(i)for(t=0,o=i.length;o>t;++t)i[t].apply(this,e);if(r)for(t=0,o=r.length;o>t;++t)r[t].apply(this,[n].concat(e));return this},n.prototype.getWildcardCallbacks=function(n){var t,o,e=[];for(t in this.callbacks)o=t.split("*"),("*"===t||2===o.length&&n.slice(0,o[1].length)===o[1])&&(e=e.concat(this.callbacks[t]));return e},t.prototype=Object.create(n.prototype,{constructor:{value:t}}),t.prototype.fetchDependencies=function(n){var t=this,o=this.config;"a1"===n?l.h2sSupport()?(console.log("setting up wcgphono"),this.phono=c.wcgphono(l.extend(o,{phone:{onIncomingCall:t._normalizeNonPhonoCallHandlers.bind(t)},onReady:function(){t.emit("ready")}}))):alert("Please use the special Ericsson build of Chromium. It can be downloaded from: http://js.att.io/browsers"):"a2"===n?l.h2sSupport()?(console.log("setting up h2sphono"),this.phono=c.h2sphono(l.extend(o,{phone:{onIncomingCall:t._normalizeNonPhonoCallHandlers.bind(t)},onReady:function(){t.emit("ready")}}))):alert("Please use the special Ericsson build of Chromium. It can be downloaded from: http://js.att.io/browsers"):(console.log("setting up phono"),this.phono=c.phono(l.extend(o,{phone:{onIncomingCall:t._normalizeNonPhonoCallHandlers.bind(t),ringTone:"",ringbackTone:""},onReady:function(){t.sessionId=this.sessionId,l.getMe(o.apiKey,function(n){t.bindNumberToPhonoSession(n.number,t.sessionId,function(){t.emit("ready")})})}})))},t.prototype.bindNumberToPhonoSession=function(n,t,o){c.ajax({url:"http://binder.api.tfoundry.com/session/"+n+"/"+t,type:"POST",success:function(){o()}})},t.prototype.disconnect=function(){this.phono.disconnect(),this.phono=null},t.prototype.connected=function(){return!!this.phono},t.prototype._normalizeNonPhonoCallHandlers=function(n){var t,e,i=n.call;i&&(t=new o(this,i),e=t.initiator||t._call.recipient||"",e=e.replace("tel:","").replace("sip:",""),e=e.split("@")[0],t.call=t,this.emit("incomingCall",t,s.phoneNumber.parse(e)))},t.prototype.dial=function(n,t){var e,i,r=this,a=s.phoneNumber.getCallable(n);return this.emit("calling",n),e="a3"===this.config.version?this.phono.phone.dial("sip:"+a+"@12.208.176.26",{callerId:r.config.myNumber+"@phono06.tfoundry.com"}):this.phono.phone.dial(a,{}),i=new o(this,e),i.bind(t),i.emit("ring"),this.emit("outgoingCall",i),i},o.prototype=Object.create(n.prototype,{constructor:{value:o}}),o.prototype.bind=function(n){var t=this,o={onRing:"ring",onAnswer:"callBegin",onHangup:"callEnd",onHold:"hold",onRetrieve:"retrieve",onWaiting:"waiting",onError:"error"},e=n||{};this._att,l.each(o,function(n,o){l.isFunc(e[n])&&t.on(o,e[n])})},o.prototype.answer=function(){return this._call.answer()},o.prototype.hangup=function(){return this._call.hangup()},o.prototype.digit=function(n){return this._call.digit(n)},o.prototype.pushToTalk=function(n){return this._call.pushToTalk(n)},o.prototype.talking=function(n){return this._call.talking(n)},o.prototype.mute=function(n){return this._call.mute(n)},o.prototype.hold=function(n){return this._call.hold(n)},o.prototype.volume=function(n){return this._call.volume(n)},o.prototype.gain=function(n){return this._call.gain(n)},o.prototype.__defineGetter__("initiator",function(){return this._call.initiator}),o.prototype.transferto=function(n){var t=s.phoneNumber.getCallable(n);this._call.transferto(t)},s.Phone=t,c&&(c.att=function(n){return new t(n)}),e.prototype.get=function(n,t){c.ajax({url:this.baseUrl+n+"?access_token="+this.token,success:function(n){t(null,n)},error:function(n){t(n)}})},e.prototype.put=function(n,t,o){c.ajax({url:this.baseUrl+n+"?access_token="+this.token,type:"put",data:t,success:function(n){o(null,n)},error:function(n){o(n)}})},e.prototype.post=function(n,t,o){c.ajax({url:this.baseUrl+n+"?access_token="+this.token,type:"post",data:t,success:function(n){o(null,n)},error:function(n){o(n)}})},e.prototype.delete=function(n,t){c.ajax({url:this.baseUrl+n,type:"delete",success:function(n){t(null,n)},error:function(n){t(n)}})},i.prototype.getContacts=function(n){this.api.get("/contacts",n)},i.prototype.getContact=function(n,t){this.api.get("/contacts/"+n,t)},i.prototype.addContact=function(n,t){this.api.post("/contacts",n,t)},i.prototype.updateContact=function(n,t,o){this.api.put("/contacts/"+n,t,o)},i.prototype.deleteContact=function(n,t){this.api.delete("/contacts/"+n,t)},i.prototype.getGroups=function(n){this.api.get("/groups",n)},i.prototype.getGroup=function(n,t){this.api.get("/groups/"+n,t)},i.prototype.addGroup=function(n,t){this.api.post("/groups",n,t)},i.prototype.updateGroup=function(n,t,o){this.api.post("/groups/"+n,t,o)},i.prototype.deleteGroup=function(n,t){this.api.delete("/groups/"+n,t)},s.AddressBook=i,c&&(c.addressBook=function(n){return new i(n)}),"undefined"!=typeof exports?module.exports=s:(r.ATT||(r.ATT={}),l.extend(r.ATT,s))}).call(this);