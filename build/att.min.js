(function(){function e(e,t){this.token=e,this.baseUrl=t,this.errorHandlers={401:function(){},402:function(){},403:function(){}}}function t(){this.callbacks={}}function n(e){var n=this,o=e||{},i=this.config={apiKey:"",user:u.uuid(),jid:"",log:!0,ringTone:"",ringbackTone:"",dependencyBaseUrl:"//js.att.io"},r={onReady:"ready",onUser:"user",onUnReady:"unready",onError:"error",onCallBegin:"callBegin",onCallEnd:"callEnd",onOutgoingCall:"outgoingCall",onCalling:"calling"},a={onError:"error",onCallBegin:"callBegin",onCallEnd:"callEnd"},s=function(){return u.isFunc(e.onIncomingCall)?e.onIncomingCall:e.phone&&u.isFunc(e.phone.onIncomingCall)?e.phone.onIncomingCall:function(){}}();return t.call(this),u.extend(this.config,o),this.config.incomingCallHandler=s,delete this.config.onIncomingCall,this.config.phone&&delete this.config.phone.onIncomingCall,this.phone=this,this.on("incomingCall",s),u.each(r,function(e,t){u.isFunc(n.config[e])&&(n.on(t,n.config[e]),n.config[e]=function(e){n.emit(t,e)})}),o.phone&&u.each(a,function(e,t){u.isFunc(n.config.phone[e])&&(n.on(t,n.config.phone[e]),n.config.phone[e]=function(e){n.emit(t,e)})}),this.config.log&&this.on("*",function(e,t){console.log("att.js event:",e,t)}),u.getMe(this.config.apiKey,function(e){e.version=i.version||u.getQueryParam("version")||e.version,i.version=e.version,i.myNumber=e.number,console.log("using API version:",i.version),n.emit("user",e),"a1"===i.version||"a2"===i.version?c.getScript(i.dependencyBaseUrl+"/js/att."+i.version+".js",function(){n.fetchDependencies(i.version)}):c.getScript(i.dependencyBaseUrl+"/js/phono.06.js",function(){i.token=i.apiKey,i.apiKey="7826110523f1241fcfd001859a67128d",i.connectionUrl="http://gw.att.io:8080/http-bind",n.fetchDependencies()})}),n}function o(e,n){var o=this;return this._att=e,this._call=n,this.id=n.id,t.call(this),this.on("*",function(e){o._att.emit(e,o)}),this._call.bind({onRing:function(){o.emit("ring")},onAnswer:function(){o.emit("callBegin")},onHangup:function(){o.emit("callEnd")},onHold:function(){o.emit("hold")},onRetrieve:function(){o.emit("retrieve")},onWaiting:function(){o.emit("waiting")},onError:function(){o.emit("error")}}),this}function i(n){this.api=new e(n,"https://api.foundry.att.com/a4/addressbook"),t.call(this),this.api.errorHandlers[404]=this._badToken.bind(this),this.api.errorHandlers[401]=this._badToken.bind(this)}function r(n){this.api=new e(n,"https://api.foundry.att.com/a1/messages"),t.call(this),this.api.errorHandlers[404]=this._badToken.bind(this),this.api.errorHandlers[401]=this._badToken.bind(this)}var a=this,s={},l={},c=a.jQuery,u=s.util={_uuidCounter:0,uuid:function(){return Math.random().toString(16).substring(2)+(u._uuidCounter++).toString(16)},slice:Array.prototype.slice,isFunc:function(e){return"[object Function]"==Object.prototype.toString.call(e)},extend:function(e){return this.slice.call(arguments,1).forEach(function(t){if(t)for(var n in t)e[n]=t[n]}),e},each:function(e,t){if(e)if(e instanceof Array)e.forEach(t);else for(var n in e)t(n,e[n])},getQueryParam:function(e){var t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n="[\\?&]"+t+"=([^&#]*)",o=RegExp(n),i=o.exec(window.location.search);return i?decodeURIComponent(i[1].replace(/\+/g," ")):void 0},h2sSupport:function(){return"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/536.4 (KHTML, like Gecko) Chrome/19.0.1077.0 Safari/536.4"==window.navigator.userAgent||"Mozilla/5.0 (iPhone; CPU iPhone OS 6_0_1 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Mobile/10A523"==window.navigator.userAgent||window.webkitPeerConnection00&&-1!==window.navigator.userAgent.indexOf("Chrome/24")},getMe:function(e,t){var n="https://auth.tfoundry.com",o={access_token:e};return l.me?t(l.me):(console.log(o),c.ajax({data:o,dataType:"json",url:n+"/me.json",success:function(e){l.me=e,c.ajax({data:o,dataType:"json",url:n+"/users/"+e.uid+"/api_services/webrtc.json",success:function(n){var o=n&&n.version,i=n&&n.options&&n.options.phone_number;e.version=o?"a"+o:"a1",e.number=i||e.phone_number,t(e)}})}}),void 0)}};e.prototype.get=function(e,t){var n=this;c.ajax({url:this.baseUrl+e+"?access_token="+this.token,success:function(e){t(null,e)},error:function(e){console.log("err",e);var o=n.errorHandlers[e.status];o&&o(),t(e)}})},e.prototype.put=function(e,t,n){var o=this;c.ajax({url:this.baseUrl+e+"?access_token="+this.token,type:"put",data:t,success:function(e){n(null,e)},error:function(e){var t=o.errorHandlers[e.status];t&&t(),n(e)}})},e.prototype.post=function(e,t,n){var o=this;c.ajax({url:this.baseUrl+e+"?access_token="+this.token,type:"post",data:t,success:function(e){n(null,e)},error:function(e){var t=o.errorHandlers[e.status];t&&t(),n(e)}})},e.prototype.delete=function(e,t){var n=this;c.ajax({url:this.baseUrl+e+"?access_token="+this.token,type:"delete",success:function(e){t(null,e)},error:function(e){var o=n.errorHandlers[e.status];o&&o(),t(e)}})},t.prototype.on=function(e){var t=3===arguments.length,n=t?arguments[1]:void 0,o=t?arguments[2]:arguments[1];return o._groupName=n,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},t.prototype.once=function(e,t){function n(){o.off(e,n),t.apply(this,arguments)}var o=this;return this.on(e,n),this},t.prototype.releaseGroup=function(e){var t,n,o,i;for(t in this.callbacks)for(i=this.callbacks[t],n=0,o=i.length;o>n;n++)i[n]._groupName===e&&(i.splice(n,1),n--,o--);return this},t.prototype.off=function(e,t){var n,o=this.callbacks[e];return o?1===arguments.length?(delete this.callbacks[e],this):(n=o.indexOf(t),o.splice(n,1),this):this},t.prototype.emit=function(e){var t,n,o=[].slice.call(arguments,1),i=this.callbacks[e],r=this.getWildcardCallbacks(e);if(i)for(t=0,n=i.length;n>t;++t)i[t].apply(this,o);if(r)for(t=0,n=r.length;n>t;++t)r[t].apply(this,[e].concat(o));return this},t.prototype.getWildcardCallbacks=function(e){var t,n,o=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[1].length)===n[1])&&(o=o.concat(this.callbacks[t]));return o};var p={};p.stringify=function(e){var t,n=p.parse(e),o=n.length,i="1"===n.charAt(0),r=n.split("");return o>(i?11:10)?n:!i&&4>o?n:(i&&r.splice(0,1),i?o>1&&(t=4-o,t=t>0?t:0,r.splice(0,0," ("),r.splice(4,0,Array(t+1).join(" ")+") "),o>7&&r.splice(8,0,"-")):o>7?(r.splice(0,0,"("),r.splice(4,0,") "),r.splice(8,0,"-")):o>3&&r.splice(3,0,"-"),(i?"1":"")+r.join(""))},p.parse=function(e){return(e+"").toUpperCase().replace(/[A-Z]/g,function(e){return 0|(e.charCodeAt(0)-65)/3+2-("SVYZ".indexOf(e)>-1)}).replace(/\D/g,"")},p.getCallable=function(e,t){var n=t||"us",o=p.parse(e);return 10!==o.length?"us"==n&&11===o.length&&"1"===o.charAt(0)?o:!1:"us"==n?"1"+o:void 0},s.phoneNumber=p,c&&(c.phoneNumber=p);var d,f,h={},g="https://api.foundry.att.com/a2/locker";h.getUrl=function(e){var t=window.att.config.apiKey,n="";return n=e?g+"/"+e+"?access_token="+t:g+"?access_token="+t,console.debug("url = "+n),n},h.constructReturnData=function(e,t){var n={};return n.status=t,n.data=e,JSON.stringify(n)},h.getUploadTicketSuccess=function(e,t){console.debug("success getUploadTicket. textStatus = "+t),console.debug(JSON.stringify(e)),console.log(e.token),h.renderUploadForm(e.token)},h.getUploadTicketError=function(e,t){console.error("error getUploadTicket. textStatus = "+t),console.error(JSON.stringify(e))},h.deleteSuccess=function(e,t){console.debug("success delete. textStatus = "+t),console.debug(JSON.stringify(e))},h.deleteError=function(e,t){console.error("error delete. textStatus = "+t),console.error(JSON.stringify(e))},h.getMediaSuccess=function(e,t){console.debug("success getMedia. textStatus = "+t),f(h.constructReturnData(e,t))},h.getMediaError=function(e,t){console.error("error getMedia. textStatus = "+t),console.error(JSON.stringify(e)),f(h.constructReturnData(e,t))},h.uploadFileSuccess=function(e,t){console.debug("success uploadFile. textStatus = "+t),console.debug(JSON.stringify(e))},h.uploadFileError=function(e,t){console.error("error uploadFile. textStatus = "+t),console.error(JSON.stringify(e))},h.getUploadTicket=function(){var e=h.getUrl("upload");c.ajax({type:"GET",url:e,success:h.getUploadTicketSuccess,error:h.getUploadTicketError})},h.uploadFileFormData=function(e){if(console.debug("uploading file token = "+e),void 0==e||""==e.trim())return console.error("invalid token. try again"),void 0;var t=new FormData,n="https://UCM01-STG1A-DATCHL-ucm.att.com/data/1_0_0/upload/";filename=d.name,t.append("Filename",filename),t.append("X-Duplicate",!0),t.append("Object-Name",filename),t.append("Upload-Token",e);var o=new FileReader;o.onloadend=function(e){console.debug("loaded file"),console.log(e);var o=e.target.result;t.append("File",o),c.ajax({type:"POST",url:n,contentType:!1,contentLength:1089207,processData:!1,cache:!1,data:t,success:h.uploadFileSuccess,error:h.uploadFileError})},console.log("end"),o.readAsBinaryString(d),console.log("after read")},h.uploadFile=function(e){if(console.debug("uploading file token = "+e),void 0==e||""==e.trim())return console.error("invalid token. try again"),void 0;myfile=d,fileName=myfile.name;var t="https://UCM01-STG1A-DATCHL-ucm.att.com/data/1_0_0/upload/",n=""+Math.floor(1e6*Math.random()),o="\r\n",i=o;i+="------"+n+o,i+='Content-Disposition: form-data; name="Filename"'+o,i+=o,i+=fileName+o,i+="------"+n+o,i+='Content-Disposition: form-data; name="X-Duplicate"'+o,i+=o+"true"+o,i+="------"+n+o,i+='Content-Disposition: form-data; name="Object-Name"'+o,i+=o,i+=fileName+o,i+="------"+n+o,i+='Content-Disposition: form-data; name="Upload-Token"'+o,i+=o,i+=e+o,i+="------"+n+o,i+='Content-Disposition: form-data; name="File"; filename="'+fileName+'"'+o,i+="Content-Type: image/jpeg"+o,i+=o;var r=new FileReader;r.onloadend=function(e){console.debug("loaded file"),console.log(e),i+=e.target.result,i+=o+"------"+n+"--"+o,c.ajax({type:"POST",url:t,contentType:"multipart/form-data; boundary=----"+n,data:i,success:h.uploadFileSuccess,error:h.uploadFileError})},console.log("end"),r.readAsDataURL(myfile),console.log("after read")},h.upload=function(e){d=e,console.debug("getting upload ticket"),h.getUploadTicket()},h.getMedia=function(e){var t=h.getUrl("media");f=e,c.ajax({type:"GET",url:t,success:h.getMediaSuccess,error:h.getMediaError})},h.delete=function(e){var t=h.getUrl("data");data={},data.fileIDs=e,c.ajax({type:"POST",url:t,data:JSON.stringify(data),success:h.deleteSuccess,error:h.deleteError})},h.renderUploadForm=function(e){if(console.debug("uploading file token = "+e),void 0==e||""==e.trim())return console.error("invalid token. try again"),void 0;if(1!=c("#locker_file_upload").length)return console.error("div with id locker_file_upload not found. please create one"),void 0;var t="https://UCM01-STG1A-DATCHL-ucm.att.com/data/1_0_0/upload/",n=document.createElement("form");n.setAttribute("id","locker_file_upload_form"),n.setAttribute("method","POST"),n.setAttribute("enctype","multipart/form-data"),n.setAttribute("target","_blank"),n.setAttribute("action",t);var o=document.createElement("input");o.setAttribute("id","locker_file_upload_form_filename_input"),o.setAttribute("name","Filename"),o.setAttribute("type","hidden"),n.appendChild(o);var i=document.createElement("input");i.setAttribute("id","locker_file_upload_form_xduplicate_input"),i.setAttribute("name","X-Duplicate"),i.setAttribute("value","true"),i.setAttribute("type","hidden"),n.appendChild(i);var r=document.createElement("input");r.setAttribute("id","locker_file_upload_form_objectname_input"),r.setAttribute("name","Object-Name"),r.setAttribute("type","hidden"),n.appendChild(r);var a=document.createElement("input");a.setAttribute("id","locker_file_upload_form_uploadtoken_input"),a.setAttribute("name","Upload-Token"),a.setAttribute("value",e),a.setAttribute("type","hidden"),n.appendChild(a);var s=document.createElement("input");s.setAttribute("id","locker_file_upload_form_file_input"),s.setAttribute("name","File"),s.setAttribute("type","file"),n.appendChild(s);var l=document.createElement("input");l.setAttribute("name","Submit"),l.setAttribute("value","Upload"),l.setAttribute("type","submit"),n.appendChild(l),n.onSubmit=function(){return filename=c("#locker_file_upload_form_file_input").val().split("\\")[s.split("\\").length-1],c("#locker_file_upload_form_filename_input").val(filename),c("#locker_file_upload_form_objectname_input").val(filename),!1},document.getElementById("locker_file_upload").appendChild(n)},s.locker=h,n.prototype=Object.create(t.prototype,{constructor:{value:n}}),n.prototype.fetchDependencies=function(e){var t=this,n=this.config;"a1"===e?u.h2sSupport()?(console.log("setting up wcgphono"),this.phono=c.wcgphono(u.extend(n,{phone:{onIncomingCall:t._normalizeNonPhonoCallHandlers.bind(t)},onReady:function(){t.emit("ready")}}))):alert("Please use the special Ericsson build of Chromium. It can be downloaded from: http://js.att.io/browsers"):"a2"===e?u.h2sSupport()?(console.log("setting up h2sphono"),this.phono=c.h2sphono(u.extend(n,{phone:{onIncomingCall:t._normalizeNonPhonoCallHandlers.bind(t)},onReady:function(){t.emit("ready")}}))):alert("Please use the special Ericsson build of Chromium. It can be downloaded from: http://js.att.io/browsers"):(console.log("setting up phono"),this.phono=c.phono(u.extend(n,{phone:{onIncomingCall:t._normalizeNonPhonoCallHandlers.bind(t),ringTone:"",ringbackTone:""},onReady:function(){t.sessionId=this.sessionId,u.getMe(n.apiKey,function(e){t.bindNumberToPhonoSession(e.number,t.sessionId,function(){t.emit("ready")})})}})))},n.prototype.bindNumberToPhonoSession=function(e,t,n){c.ajax({url:"http://binder.api.tfoundry.com/session/"+e+"/"+t,type:"POST",success:function(){n()}})},n.prototype.disconnect=function(){this.phono.disconnect(),this.phono=null},n.prototype.connected=function(){return!!this.phono},n.prototype._normalizeNonPhonoCallHandlers=function(e){var t,n,i=e.call;i&&(t=new o(this,i),n=t.initiator||t._call.recipient||"",n=n.replace("tel:","").replace("sip:",""),n=n.split("@")[0],t.call=t,this.emit("incomingCall",t,s.phoneNumber.parse(n)))},n.prototype.dial=function(e,t){var n,i,r=this,a=s.phoneNumber.getCallable(e);return this.emit("calling",e),n="a3"===this.config.version?this.phono.phone.dial("sip:"+a+"@12.208.176.26",{callerId:r.config.myNumber+"@phono06.tfoundry.com"}):this.phono.phone.dial(a,{}),i=new o(this,n),i.bind(t),i.emit("ring"),this.emit("outgoingCall",i),i},o.prototype=Object.create(t.prototype,{constructor:{value:o}}),o.prototype.bind=function(e){var t=this,n={onRing:"ring",onAnswer:"callBegin",onHangup:"callEnd",onHold:"hold",onRetrieve:"retrieve",onWaiting:"waiting",onError:"error"},o=e||{};this._att,u.each(n,function(e,n){u.isFunc(o[e])&&t.on(n,o[e])})},o.prototype.answer=function(){return this._call.answer()},o.prototype.hangup=function(){return this._call.hangup()},o.prototype.digit=function(e){return this._call.digit(e)},o.prototype.pushToTalk=function(e){return this._call.pushToTalk(e)},o.prototype.talking=function(e){return this._call.talking(e)},o.prototype.mute=function(e){return this._call.mute(e)},o.prototype.hold=function(e){return this._call.hold(e)},o.prototype.volume=function(e){return this._call.volume(e)},o.prototype.gain=function(e){return this._call.gain(e)},o.prototype.__defineGetter__("initiator",function(){return this._call.initiator}),o.prototype.transferto=function(e){var t=s.phoneNumber.getCallable(e);this._call.transferto(t)},s.Phone=n,c&&(c.att=function(e){return new n(e)}),i.prototype=Object.create(t.prototype,{constructor:{value:i}}),i.prototype._badToken=function(){this.emit("invalidToken")},i.prototype.getContacts=function(e){this.api.get("/contacts",e)},i.prototype.getContact=function(e,t){this.api.get("/contacts/"+e,t)},i.prototype.addContact=function(e,t){this.api.post("/contacts",e,t)},i.prototype.updateContact=function(e,t,n){this.api.put("/contacts/"+e,t,n)},i.prototype.deleteContact=function(e,t){this.api.delete("/contacts/"+e,t)},i.prototype.getGroups=function(e){this.api.get("/groups",e)},i.prototype.getGroup=function(e,t){this.api.get("/groups/"+e,t)},i.prototype.addGroup=function(e,t){this.api.post("/groups",e,t)},i.prototype.updateGroup=function(e,t,n){this.api.post("/groups/"+e,t,n)},i.prototype.deleteGroup=function(e,t){this.api.delete("/groups/"+e,t)},s.AddressBook=i,c&&(c.addressBook=function(e){return new i(e)}),r.prototype=Object.create(t.prototype,{constructor:{value:r}}),r.prototype._badToken=function(){this.emit("invalidToken")},r.prototype.sendMessage=function(e,t,n){this.api.post("/messages",{recipient:e,text:t},n)},r.prototype.getMessages=function(e){this.api.get("/messages",e)},r.prototype.getMessage=function(e,t){this.api.get("/messages/"+e,t)},r.prototype.deleteMessage=function(e,t){this.api.delete("/messages/"+e,t)},r.prototype.searchByNumber=function(e,t){this.api.get("/messages/filter/"+e,t)},s.Messages=r,c&&(c.messages=function(e){return new r(e)}),"undefined"!=typeof exports?module.exports=s:(a.ATT||(a.ATT={}),u.extend(a.ATT,s))}).call(this);